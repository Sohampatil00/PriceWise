{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the e-commerce system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "category": {
          "type": "string",
          "description": "Category of the product."
        },
        "cost": {
          "type": "number",
          "description": "Cost of the product in Rupees."
        },
        "currentPrice": {
          "type": "number",
          "description": "Current selling price of the product in Rupees."
        },
        "minPrice": {
          "type": "number",
          "description": "Minimum allowable price for the product in Rupees."
        },
        "maxPrice": {
          "type": "number",
          "description": "Maximum allowable price for the product in Rupees."
        },
        "targetMargin": {
          "type": "number",
          "description": "Target profit margin for the product (percentage)."
        },
        "inventory": {
          "type": "number",
          "description": "Current inventory level of the product."
        },
        "salesLast30d": {
          "type": "number",
          "description": "Number of sales in the last 30 days."
        }
      },
      "required": [
        "id",
        "name",
        "cost",
        "currentPrice",
        "minPrice",
        "maxPrice",
        "targetMargin",
        "inventory",
        "salesLast30d"
      ]
    },
    "CompetitorPrice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CompetitorPrice",
      "type": "object",
      "description": "Represents a competitor's pricing information for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the competitor price."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N CompetitorPrice)"
        },
        "competitor": {
          "type": "string",
          "description": "Name of the competitor."
        },
        "price": {
          "type": "number",
          "description": "Competitor's price for the product in Rupees."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Timestamp of the last price update.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "competitor",
        "price",
        "lastUpdated"
      ]
    },
    "PriceHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PriceHistory",
      "type": "object",
      "description": "Represents the historical price changes of a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the price history entry."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N PriceHistory)"
        },
        "price": {
          "type": "number",
          "description": "Price of the product in Rupees at the time of the change."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the price change occurred.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "price",
        "timestamp"
      ]
    },
    "PricingRule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PricingRule",
      "type": "object",
      "description": "Represents a pricing rule or constraint applied to a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pricing rule."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N PricingRule)"
        },
        "ruleName": {
          "type": "string",
          "description": "Name of the pricing rule (e.g., 'never_below_cost')."
        },
        "ruleExpression": {
          "type": "string",
          "description": "Expression defining the pricing rule (e.g., 'price >= cost * 1.2')."
        }
      },
      "required": [
        "id",
        "productId",
        "ruleName",
        "ruleExpression"
      ]
    },
    "DemandForecast": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DemandForecast",
      "type": "object",
      "description": "Represents a demand forecast for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the demand forecast."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N DemandForecast)"
        },
        "forecastedDemand": {
          "type": "number",
          "description": "The predicted demand of the product."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp the demand was forcasted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "forecastedDemand",
        "timestamp"
      ]
    },
    "UserBase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserBase",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "Username for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., 'admin', 'user')."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role"
      ]
    },
    "AdminBase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminBase",
      "type": "object",
      "description": "Represents an administrator of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the administrator."
        },
        "username": {
          "type": "string",
          "description": "Username for the administrator."
        },
        "email": {
          "type": "string",
          "description": "Email address of the administrator.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the administrator (e.g., 'superadmin', 'admin')."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Only accessible to administrators.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/competitorPrices/{competitorPriceId}",
        "definition": {
          "entityName": "CompetitorPrice",
          "schema": {
            "$ref": "#/backend/entities/CompetitorPrice"
          },
          "description": "Stores competitor pricing information for a specific product. Only accessible to administrators.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "competitorPriceId",
              "description": "Unique identifier for the competitor price."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/priceHistory/{priceHistoryId}",
        "definition": {
          "entityName": "PriceHistory",
          "schema": {
            "$ref": "#/backend/entities/PriceHistory"
          },
          "description": "Stores the price history for a specific product. Only accessible to administrators.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "priceHistoryId",
              "description": "Unique identifier for the price history entry."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/pricingRules/{pricingRuleId}",
        "definition": {
          "entityName": "PricingRule",
          "schema": {
            "$ref": "#/backend/entities/PricingRule"
          },
          "description": "Stores pricing rules for a specific product. Only accessible to administrators.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "pricingRuleId",
              "description": "Unique identifier for the pricing rule."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/demandForecasts/{demandForecastId}",
        "definition": {
          "entityName": "DemandForecast",
          "schema": {
            "$ref": "#/backend/entities/DemandForecast"
          },
          "description": "Stores demand forecasts for a specific product. Only accessible to administrators.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "demandForecastId",
              "description": "Unique identifier for the demand forecast."
            }
          ]
        }
      },
      {
        "path": "/userbase/{userId}",
        "definition": {
          "entityName": "UserBase",
          "schema": {
            "$ref": "#/backend/entities/UserBase"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/adminbase/{adminId}",
        "definition": {
          "entityName": "AdminBase",
          "schema": {
            "$ref": "#/backend/entities/AdminBase"
          },
          "description": "Stores admin profile information.",
          "params": [
            {
              "name": "adminId",
              "description": "Unique identifier for the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support PriceWise, an e-commerce pricing optimization system, focusing on security, scalability, and maintainability. The structure emphasizes authorization independence to facilitate robust security rules and atomic operations. All prices are in Rupees.\n\n**Authorization Independence:**\nTo avoid hierarchical authorization dependencies, the `members` map is not necessary as ownership will be defined through `adminbase` and `userbase`\n\n**Structural Segregation:**\nDifferent data types with varying access requirements are stored in separate collections. This segregation simplifies security rules and improves query performance. For instance, products are stored in a separate collection from their pricing rules, competitor prices and price histories. User and Admin information are stored in segregated collections\n\n**Access Modeling:**\n*   **Admin Data:** Admin data is managed at the `/adminbase/{adminId}` path, allowing administrators full access to their profiles and associated data.\n*   **User Data:** User data is managed at the `/userbase/{userId}` path, allowing users full access to their profiles and associated data.\n*   **Product Data:** Product-related data, including products, competitor prices, price history, demand forecast, and pricing rules, are organized to ensure only admins can modify them.\n\n**QAPs Support:**\nThe segregation of data into distinct collections based on access requirements allows for secure `list` operations. For example, listing products is straightforward without needing complex filtering rules.\n\nThis structure facilitates secure and scalable operations, enabling PriceWise to efficiently manage product pricing while maintaining data integrity and security."
  }
}