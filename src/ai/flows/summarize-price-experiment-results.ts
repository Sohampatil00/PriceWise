'use server';
/**
 * @fileOverview Summarizes the results of a price experiment.
 *
 * - summarizePriceExperimentResults - A function that summarizes the results of a price experiment.
 * - SummarizePriceExperimentResultsInput - The input type for the summarizePriceExperimentResults function.
 * - SummarizePriceExperimentResultsOutput - The return type for the summarizePriceExperimentResults function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const SummarizePriceExperimentResultsInputSchema = z.object({
  experimentName: z.string().describe('The name of the price experiment.'),
  startDate: z.string().describe('The start date of the experiment (YYYY-MM-DD).'),
  endDate: z.string().describe('The end date of the experiment (YYYY-MM-DD).'),
  controlPrice: z.number().describe('The price of the product in the control group.'),
  experimentPrice: z.number().describe('The price of the product in the experiment group.'),
  controlRevenue: z.number().describe('The total revenue generated by the control group.'),
  experimentRevenue: z.number().describe('The total revenue generated by the experiment group.'),
  controlUnitsSold: z.number().describe('The total units sold in the control group.'),
  experimentUnitsSold: z.number().describe('The total units sold in the experiment group.'),
});
export type SummarizePriceExperimentResultsInput = z.infer<
  typeof SummarizePriceExperimentResultsInputSchema
>;

const SummarizePriceExperimentResultsOutputSchema = z.object({
  summary: z.string().describe('A summary of the price experiment results.'),
  revenueImpact: z.string().describe('The impact on revenue as a result of the price experiment.'),
  unitsSoldImpact: z.string().describe('The impact on units sold as a result of the price experiment.'),
  recommendedAction: z
    .string()
    .describe(
      'A recommendation on whether to adopt the experiment price, revert to the control price, or run further tests.'
    ),
});
export type SummarizePriceExperimentResultsOutput = z.infer<
  typeof SummarizePriceExperimentResultsOutputSchema
>;

export async function summarizePriceExperimentResults(
  input: SummarizePriceExperimentResultsInput
): Promise<SummarizePriceExperimentResultsOutput> {
  return summarizePriceExperimentResultsFlow(input);
}

const prompt = ai.definePrompt({
  name: 'summarizePriceExperimentResultsPrompt',
  input: {schema: SummarizePriceExperimentResultsInputSchema},
  output: {schema: SummarizePriceExperimentResultsOutputSchema},
  prompt: `You are an expert analyst tasked with summarizing the results of a price experiment and providing actionable recommendations.

  Experiment Name: {{{experimentName}}}
  Start Date: {{{startDate}}}
  End Date: {{{endDate}}}

  Control Group:
  - Price: {{{controlPrice}}}
  - Revenue: {{{controlRevenue}}}
  - Units Sold: {{{controlUnitsSold}}}

  Experiment Group:
  - Price: {{{experimentPrice}}}
  - Revenue: {{{experimentRevenue}}}
  - Units Sold: {{{experimentUnitsSold}}}

  Analyze the data and provide a concise summary of the experiment results, including the impact on revenue and units sold.
  Based on your analysis, recommend whether to adopt the experiment price, revert to the control price, or run further tests.

  Summary:
  Revenue Impact:
  Units Sold Impact:
  Recommended Action: `,
});

const summarizePriceExperimentResultsFlow = ai.defineFlow(
  {
    name: 'summarizePriceExperimentResultsFlow',
    inputSchema: SummarizePriceExperimentResultsInputSchema,
    outputSchema: SummarizePriceExperimentResultsOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);
